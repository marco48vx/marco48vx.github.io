var Undertaker=new Class({Implements:[Events,Options],options:{url:location.href,action_name:"delete_item",enable_promoter:false,promoter_action:"approve_item",itemSelector:"li",itemsIgnore:"data-undertaker-ignore",do_fx:true,btn_class:"undertaker_thumbnails",btn_html:"&times;",promoter_btn_class:"undertaker_thumbnails undertaker_green",promoter_btn_html:"+",require_reason:false,prompt_view_url:location.href,trans_property:"opacity",trans_value:"0",btn_hover:false,duration:300,transition:Fx.Transitions.Expo.easeIn,onRemove:function(){},onComplete:function(){}},initialize:function(e,t){if(e){e=$(e);if(e.hasClass("kane")){return}this.container_selector=e.get("id");if(this.container_selector){this.container_selector_type="id"}else{this.container_selector_type="class";var o=e.get("class");o=o.split(" ").join(", ."+e.get("tagName"));this.container_selector="."+o}this.setOptions(t);this.createRequest();this.attachBtns();Signal.browse.attachEvents.add(this.onBrowseEventsReady.bind(this))}},createRequest:function(){this.request=new Request.HTML({url:this.options.url,method:"post",onComplete:function(){this.fireEvent("onComplete")}.bind(this)})},attachBtns:function(){var e,t,o,s,i;if(this.container_selector_type==="id"){e=$(this.container_selector)}else{e=$$(this.container_selector)[0]}if(e.hasClass("kane")){return}o=e.get(this.options.itemsIgnore);e.getElements(this.options.itemSelector).each(function(e){if(e.get("id")){t=e.get("id").split("_");s=t[1]}else{s=e.get("data-undertaker-id")}if(!s){return}if(o&&o.indexOf(s)>=0){return}i=new Element("a",{href:"javascript:void(0);",html:this.options.btn_html,class:this.options.btn_class,title:"Delete this item","data-action-type":"delete"});if(this.options.btn_hover){e.addEvent("mouseenter",function(e){i.show()});e.addEvent("mouseleave",function(e){i.hide()})}e.adopt([i]);i.removeEvents("click");if(this.options.require_reason){i.addEvent("click",this.promptReason.bind(this))}else{i.addEvent("click",this.bury.bind(this))}},this);if(e.hasClass("promoter_list")){e.getElements(this.options.itemSelector).each(function(e){var t=new Element("a",{href:"javascript:void(0);",html:this.options.promoter_btn_html,class:this.options.promoter_btn_class,title:"Approve this item","data-action-type":"promote"});if(this.options.btn_hover){e.addEvent("mouseenter",function(e){t.show()});e.addEvent("mouseleave",function(e){t.hide()})}e.adopt([t]);t.addEvent("click",this.bury.bind(this))},this)}},promptReason:function(e){var t=e,o=e.target.getParent(),s=String.from(o.get("id")),i=s.split("_");Singletonbox.open({url:this.options.prompt_view_url+"/"+i[1],width:500,position:"fixed",top:"auto",onLoad:function(e){var o=$("lightbox_content").getElements("input#submit")[0];o.addEvent("click",function(){t.reason=$("reason").value;this.bury(t);Singletonbox.close()}.bind(this))}.bind(this)})},bury:function(e){var t,o,s,i,n;e.stop();t=e.target.getParent();o=t.get("data-undertaker-id");if(!o){s=String.from(t.get("id"));i=s.split("_");o=i[1]?i[1]:s}if(e.target.get("data-action-type")==="promote"){n=this.options.promoter_action}else{n=this.options.action_name}if(this.options.do_fx){t.set("tween",{duration:this.options.duration,onComplete:function(){t.destroy();this.fireEvent("onRemove")}.bind(this)});t.tween(this.options.trans_property,this.options.trans_value)}else{t.destroy();this.fireEvent("onRemove")}if(typeof e.reason!=="undefined"){this.request.send({data:{action:n,id:o,reason:e.reason,token:vimeo.xsrft}})}else{this.request.send({data:{action:n,id:o,token:vimeo.xsrft}})}},onBrowseEventsReady:function(e){this.attachBtns()}});window._gtm=window._gtm||[];var Browse={container:null,cache:new Hash,paging:false,append_content:false,use_infinite_scroll:false,auto_scroll_urls:[],infinite_scroll_spy:null,scroll_spy_agents:[],scroll_spy_agent_urls:[],urlToSet:"",search_term:"",initialize:function(){if(History.addEvent){History.addEvent("change",Browse.onHistoryChange)}var e;History.addEvent("change",Browse.onHistoryChange);Browse.createElements();Browse.attachEvents();Browse.createRequest();Browse.setupAutoScroll();Browse.setupKeyboardShortcuts();Browse.updateCouchmodeUrl(window.location.href);e=Browse.container.getElement(".js-defer");if(e){var t=true;Browse.loadFromAjax(window.location.pathname,t)}if(Browse.searchForm!==null){Browse.search_term=Browse.searchForm.getElement("input").get("value")}History.pageLoad();if(document.querySelector(".pagination")){NextTooltip.init()}},createElements:function(){Browse.container=$("browser");Browse.content=$("browse_content");Browse.searchForm=Browse.container.getElement(".js-search_within")!==null?Browse.container.getElement(".js-search_within").getElement("form"):null;Browse.couchmodeLink=Browse.container.getElement(".couchmode");if(Browse.content){Browse.load_indicator=Browse.content.getElement(".js-browse-load-indicator")}},createRequest:function(){Browse.request=new Request.HTML({method:"get",link:"cancel",onSuccess:Browse.onRequestSuccess,onFailure:Browse.onRequestFailure,evalScripts:false});window._browse_request=Browse.request;Browse.groupPendingVideo=new Request.JSON({url:location.href,method:"post",onSuccess:Browse.onGroupPendingVideoSuccess})},setupAutoScroll:function(e){var t=Browse.container.getElement(".js-show_more"),o=200;if(e){Browse.killAllAgents()}if(!t){return}History.hashFallback=true;if(e){Browse.auto_scroll_urls=[];Browse.use_infinite_scroll=false}Browse.setupInfiniteScrollPages(e);if(!Browse.use_infinite_scroll){t.addEvent("click",Browse.onShowMoreClick);Browse.use_infinite_scroll=true;return}if(Browse.infinite_scroll_spy){Browse.infinite_scroll_spy.stop();Browse.infinite_scroll_spy=null}Browse.infinite_scroll_spy=new ThrottledScrollSpy({min:t.getPosition().y-window.getSize().y-o,onEnter:function(){Browse.showMore(t)}});t.hide()},setupInfiniteScrollPages:function(e){var t=$$("[data-start-page]").pop(),o=$$("[data-end-page]").pop();if(e){Browse.killAllAgents()}if(t!==undefined){if(Browse.scroll_spy_agent_urls.contains(t.get("data-start-page"))){return}}var s=$$(".col_small")[0],i=new ThrottledScrollSpy({min:s.getSize().y+s.getPosition().y+100,onEnter:function(e,t,o){Browse.addToTopLink()},onLeave:function(e,t,o){Browse.removeToTopLink()}});if(t&&o){Browse.scroll_spy_agents.push(new ThrottledScrollSpy({min:t.getCoordinates().top,max:o.getCoordinates().bottom,onEnter:function(){if(History.getPath()!==t.get("data-start-page")){Browse.append_content=true;History.push(t.get("data-start-page"))}}}));Browse.scroll_spy_agent_urls.push(t.get("data-start-page"))}},killAllAgents:function(){Browse.scroll_spy_agents.each(function(e){e.stop()});Browse.scroll_spy_agents=[];Browse.scroll_spy_agent_urls=[]},onShowMoreClick:function(e){e.preventDefault();Browse.showMore(e.target)},showMore:function(e){var t=e.get("href");if(!Browse.auto_scroll_urls.contains(t)){e.destroy();$$(".hide_on_scroll").hide();Browse.container.getElement(".js-while_loading").show();Browse.addContentFromUrl(t);Browse.auto_scroll_urls.push(t)}if(Browse.infinite_scroll_spy){Browse.infinite_scroll_spy.stop()}},addToTopLink:function(){var e=$("top_link");var t=$$("div.topnav_sticky")[0];var o=t?t.getSize().y+20:20;if(e){e.setStyle("top",o);e.show();return false}var s=new Element("a",{id:"top_link",class:"btn iconify_up_b",html:Copy.translate("top"),styles:{top:o},events:{click:function(){Global.scroll.toTop();Browse.removeToTopLink()}}});$$(".col_small").adopt(s)},removeToTopLink:function(){if($("top_link")){$("top_link").hide()}},addContentFromUrl:function(e){Browse.setWatchLaterUrl(e);Browse.append_content=true;Browse.request.send({url:e})},setupKeyboardShortcuts:function(){Global.keyManager.register("left",Browse.goPrev);Global.keyManager.register("right",Browse.goNext);Global.keyManager.register("j",Browse.selectNextVideo);Global.keyManager.register("k",Browse.selectPreviousVideo);Global.keyManager.register("enter",Browse.goToVideo)},attachEvents:function(e){var t=$("follow_btn"),o=Browse.container.getElement(".js-browse_list"),s;if(e!==true&&Browse.container){Browse.container.addEvent("click:relay(a)",Browse.onBrowseLinkClick);Browse.container.addEvent("click:relay(button)",Browse.onBrowseButtonClick);Browse.container.addEvent("click:relay(.js-title)",Browse.onFeedTitleClick);Signal.browse.cache.success.add(Browse.reBindLightboxes);Signal.browse.ajax.success.add(Browse.reBindLightboxes);Signal.browse.infiniteLoad.add(Browse.reBindLightboxes);if(t!==null){t.addEvent("click",Browse.onFollowLinkClick);t.addEvents({mouseover:function(e){Browse.onFollowLinkHover(e)},mouseout:function(e){Browse.onFollowLinkHover(e)}})}if(o&&o.getElements("form.pending_video").length){Browse.container.addEvents({"click:relay(form.pending_video .accept, form.pending_video .reject)":Browse.updatePendingVideo})}}if(Browse.searchForm!==null&&Browse.searchForm.retrieve("validator")===null){s=new Form.Validator(Browse.searchForm,{onFormValidate:function(e,t,o){if(e===false){t.getElement("input").focus();return}o.stop();var s=null,i=encodeURIComponent(t.getElement("input").get("value")),n=t.get("action").split("/sort:"),r=t.get("action").split("/filter:"),a=t.get("action").split("/format:"),l=t.get("action").split("/year:");if(n.length>1){s=n[0]+"/search:"+i+"/sort:"+n[1]}else if(r.length>1){s=r[0]+"/search:"+i+"/filter:"+r[1]}else if(a.length>1){s=a[0]+"/search:"+i+"/format:"+a[1]}else if(l.length>1){s=l[0]+"/search:"+i+"/year:"+l[1]}if(s!==null){Browse.search_term=i;History.push(s)}}})}if(Browse.searchForm){Browse.searchForm.getElements(".cancel").addEvent("click",Browse.onCancelSearch)}Signal.browse.attachEvents.dispatch(e)},loadFromCache:function(e){var t;if(Browse.paging!==false){t=$("tutorials")===null?"content":"browser";Global.smoothScroll(t);Browse.paging=false}Browse.container.set("html",Browse.cache.get(e));Browse.createElements();Browse.attachEvents(true);Browse.updateCouchmodeUrl(window.location.href);Browse.setupAutoScroll(true);if(typeof FauxPlayer!=="undefined"){FauxPlayer.initialize()}if(Browse.focus_first_video){Browse.selectNextVideo();Browse.focus_first_video=false}Browse.setupAutoScroll(true);Signal.browse.cache.success.dispatch();Browse.onContentLoaded(e)},setWatchLaterUrl:function(e){if(e.contains("/watchlater")&&typeof WatchLater==="object"){WatchLater.last_url=e}},loadFromAjax:function(e,t){var o;Browse.urlToSet=e;if(Browse.content&&!t){Browse.content.addClass("loading")}if(Browse.paging!==false){o=$("tutorials")===null?"content":"browser";Global.smoothScroll(o);Browse.paging=false}Browse.request.send({url:e})},goPrev:function(){try{Browse.paging=true;History.push($("pagination").getElement('a[rel="prev"]').get("href"))}catch(e){}},goNext:function(){try{Browse.paging=true;History.push($("pagination").getElement('a[rel="next"]').get("href"))}catch(e){}},focusElement:function(e,t){e.addClass(t||"selected");var o=$(window).getSize(),s=$(window).getScroll(),i=e.getSize(),n=e.getPosition(),r=s.y,a=s.y+o.y,l=n.y,c=n.y+i.y;if(l>=r&&c<=a){return}if(c>a){return $(window).scrollTo(s.x,s.y+c-a+10)}$(window).scrollTo(s.x,s.y-(r-l))},selectNextVideo:function(){var e=Browse.container.getElement(".js-browse_list"),t=e.getElement("li.selected"),o=$("pagination"),s=o?o.getElement('a[rel="next"]'):null;if(!t&&s&&s.hasClass("hover")){return}if(!t){var i=e.getFirst();return Browse.focusElement(i)}var n=t.getNext();if(!n&&Browse.container.getElement(".js-show_more")){Signal.browse.infiniteLoad.addOnce(Browse.selectNextVideo);Browse.container.getElement(".js-show_more").click();return}else if(!n&&o){t.removeClass("selected");s.click();return}if(n){t.removeClass("selected");Browse.focusElement(n)}},selectPreviousVideo:function(){var e=Browse.container.getElement(".js-browse_list"),t=e.getElement("li.selected"),o=$("pagination"),s=o?o.getElement('a[rel="next"]'):null;if(!t&&s&&s.hasClass("hover")){s.removeClass("hover");return Browse.focusElement(e.getLast())}if(!t){return Browse.selectNextVideo()}var i=t.getPrevious();if(!i){return}t.removeClass("selected");Browse.focusElement(i)},goToVideo:function(){var e=Browse.container.getElement(".js-browse_list"),t=e.getElement("li.selected");if(t){window.location=t.getFirst("a").get("href")}var o=$("pagination").getElement('a[rel="next"]');if(o&&o.hasClass("hover")){Browse.focus_first_video=true;Browse.goNext()}},setUrlToCache:function(e){if(Browse.urlToSet){Browse.cache.set(Browse.urlToSet,e||Browse.container.get("html"))}},killAllCache:function(){Browse.cache.each(function(e,t,o){Browse.cache.erase(t)})},removeItem:function(e){var t=Browse.container.getElement("#"+e),o=Browse.container.getElement(".js-browse_list"),s=$("pagination");if(!t){return}t.set("tween",{duration:300,onComplete:function(){t.destroy();Browse.container.getElements("li").removeClass("last");Browse.container.getElements("li:even").addClass("last");Browse.clearTabCache();if(!o.getChildren().length){if(s){if(s.getElement("a[rel=next]")){Browse.loadFromAjax(s.getElement("a.selected").get("href"))}else if(s.getElement("a[rel=prev]")){s.getElement("a[rel=prev]").click()}}else{Browse.content.set("html",'<h3 class="empty">'+Copy.dict.browse_error_no_videos+"</h3>")}}}});t.tween("opacity",0)},clearTabCache:function(e){var t;if(e===null||typeof e==="undefined"){e=History.getPathName()}if(e.indexOf("/page:")!==-1){t=e.substring(0,e.indexOf("/page:"))}else if(e.indexOf("/search:")!==-1){t=e.substring(0,e.indexOf("/search:"))}else if(e.indexOf("/sort:")!==-1){t=e.substring(0,e.indexOf("/sort:"))}else if(e.indexOf("/format:")!==-1){t=e.substring(0,e.indexOf("/format:"))}else{t=e}Browse.cache.each(function(e,o,s){if(o.indexOf(t)!==-1){Browse.cache.erase(o)}})},onContentLoaded:function(e){var t=function(){if(window.browseTabCallbacks&&window.browseTabCallbacks[e]){window.browseTabCallbacks[e]()}};if(document.readyState==="complete"){t()}else{var o=window.onload;window.onload=function(){if(typeof o==="function"){o()}t()}}},onHistoryChange:function(e){if(Browse.append_content){Browse.append_content=false;return}if(Browse.scroll_spy_agent_urls.contains(e)){var t=$$('[data-start-page="'+e+'"]'),o;if(t.length){o=t[0];Global.scroll.toElement(o)}return}if(!History.hasPushState()&&!e){e=History.getPathName()}if(Browse.cache.get(e)!==null){Browse.loadFromCache(e)}else{Browse.loadFromAjax(e)}},onBrowseLinkClick:function(e){var t=null,o=0,s=Browse.container.getElement(".js-search_within");if(this.get("data-browse-type")==="link"){return}if(this.getParent("#pagination")){e.stop();if(this.get("href")!=="#"){Browse.paging=true;History.push(this.get("href"))}return}if(this.hasClass("search_within")){s.toggleClass("open");if(s.isDisplayed()){if(Browse.searchForm.getElementById("search_field")){Browse.searchForm.getElementById("search_field").focus()}else if(Browse.searchForm.getElement("input")){Browse.searchForm.getElement("input").focus()}}return}if(this.hasClass("more")){var i=this.getSiblings(".collections");e.stop();new Request.HTML({url:this.get("href"),data:{action:"more_details"},method:"get",onSuccess:function(e,t,o,s){this.destroy();i.set("html",o).show();Browse.cache.set(History.getPathName(),Browse.container.get("html"))}.bind(this)}).send();return}if(!this.getParent(".js-tabs")&&!this.getParent(".js-sortbar")){if(this.getParent("ol")!==null){t=this.getParent("ol").get("data-stream")}if(this.getParent("li")!==null){o=this.getParent("li").get("data-position")}if(t){var n=JSON.stringify({stream_id:t,stream_pos:o});localStorage.setItem("override_stream",n)}return}e.stop();this.getParent().getChildren().removeClass("selected");this.addClass("selected");if(this.getParent(".js-tabs")){Browse.search_term="";Signal.browse.tabs.click.dispatch({from:this})}if(this.getParent("#format")){Browse.killAllCache()}History.push(this.get("href"))},onBrowseButtonClick:function(e){if(this.hasClass("js-watchlater")){e.preventDefault();var t=this,o,s=new Request.JSONP({url:t.get("data-player_url")+"/watch_later/"+t.get("data-clip-id"),data:{status:t.hasClass("selected")?0:1,token:t.get("data-token"),time:t.get("data-time")},onRequest:function(e){if(o=t.get("data-alt_text")){t.set("data-alt_text",t.get("text"));t.set("text",o)}if(t.hasClass("selected")){return t.removeClass("selected")}t.addClass("selected")}}).send();return}},onFeedTitleClick:function(e){var t=this.href,o=PlayerManager.getPlayer(this);if(o&&o.currentTime>0&&o.currentTime<o.duration-30&&!o.paused){t+="#at="+Math.floor(o.currentTime);this.href=t}},onFollowLinkHover:function(e){var t=$$("a#follow_btn"),o=t.get("html");if(e.type==="mouseover"){t.set("html",t.get("data-hover-text"))}else{t.set("html",t.get("data-btn-text"))}},onFollowLinkClick:function(e){e.preventDefault();Browse.followBtn=this;Browse.followRequest=new Request.HTML({method:"post",append:Browse.followBtn.getParent().getParent(),url:"/user"+Browse.followBtn.get("data-subject-id")+"/toggle_follow",data:{token:vimeo.xsrft,subject_id:Browse.followBtn.get("data-subject-id")},onRequest:Browse.onFollowRequest,onSuccess:Browse.onFollowRequestSuccess}).send()},onCancelSearch:function(e){e.stop();Browse.container.getElement(".js-search_within").toggleClass("open");if(Browse.search_term!==""||Browser.ie){History.push(Browse.searchForm.get("action"))}Browse.search_term=""},onRequestSuccess:function(e,t,o,s){if(Browse.append_content){return Browse.onShowMoreRequestSuccess(o,s)}Browse.container.set("html",o);var i=Browse.container.getElement(".js-search_within");if(Browse.content!==null){Browse.content.removeClass("loading")}Browse.createElements();Browse.attachEvents(true);Browse.updateCouchmodeUrl(window.location.href);if(i!==null&&i.isDisplayed()){i.getElement("input").focus()}Browse.setUrlToCache(o);Browse.onContentLoaded(Browse.urlToSet);Browse.urlToSet=null;Signal.browse.ajax.success.dispatch();if(Browse.focus_first_video){Browse.selectNextVideo();Browse.focus_first_video=false}Browse.setupAutoScroll(true);Browser.exec(s);if(typeof FauxPlayer!=="undefined"){FauxPlayer.initialize()}if(Browse.container.getElement(".js-browse_list")){Browse.container.getElement(".js-browse_list").getFirst("li").getElement("a").focus()}if(Browse.load_indicator){Browse.load_indicator.hide()}setTimeout(function(){$(document.body).addEvent("mousemove:once",function(){if($(document.activeElement)){$(document.activeElement).blur()}})},300)},reBindLightboxes:function(){Global.lightbox.attachToLinks("[data-lightbox]")},onShowMoreRequestSuccess:function(e,t){Browse.container.getElement(".js-while_loading").destroy();var o=Elements.from(e,true),s=null,i,n,r;for(var a=0,l=o.length;a<l;++a){if(o[a].get("id")==="browse_content"){s=o[a];break}}r=s.getFirst();while(r){if(r.hasClass("js-browse_list")){i=r.getChildren();break}r=r.getNext()}n=s.getElement(".pagination");$$(".pagination").set("html",n.get("html"));Browse.container.getElement(".js-browse_list").adopt(i);o.destroy();Signal.browse.infiniteLoad.dispatch();Browse.append_content=false;Browse.setupInfiniteScrollPages();Browse.setupAutoScroll();Browser.exec(t)},onRequestFailure:function(){var e=$("pagination");if(e!==null){e.destroy()}Browse.load_indicator.hide();Browse.content.empty().adopt(new Element("h3",{class:"empty flush",html:Copy.dict.browse_error_generic})).removeClass("loading");Signal.browse.ajax.error.dispatch()},onFollowRequest:function(){var e=parseInt(Browse.followBtn.get("data-subscribed"),10);Browse.followBtn.set("data-subscribed",1-e);if(e){Browse.followBtn.removeClass("following").addClass("unfollowing").addClass("btn_gray")}else{Browse.followBtn.addClass("btn_disabled")}if(vimeo&&vimeo.config&&vimeo.config.tag){if(e){if(window.__fa){window.__fa.push(["trackEvent",{container:"follow_tag",component:"unfollow",keyword:vimeo.config.tag}])}}else{if(window.__fa){window.__fa.push(["trackEvent",{container:"follow_tag",component:"follow",keyword:vimeo.config.tag}])}window._gtm.push({event:"follow_tag_click","follow_tag_click.tag":vimeo.config.tag})}}Signal.browse.ajax.request.dispatch()},onFollowRequestSuccess:function(e){var t=Browse.followBtn.get("data-hover-text"),o=Browse.followBtn.get("data-btn-text"),s=parseInt(Browse.followBtn.get("data-subscribed"),10);Browse.followBtn.set("data-btn-text",Browse.followBtn.get("data-alternate-text")).set("html",Browse.followBtn.get("data-alternate-text")).set("data-hover-text",Browse.followBtn.get("data-alternate-hover")).set("data-alternate-text",o).set("data-alternate-hover",t);if(s){Browse.followBtn.removeClass("follow").removeClass("btn_disabled").addClass("following").blur()}else{Browse.followBtn.removeClass("unfollowing").removeClass("btn_gray").addClass("follow").blur();$$("div.follow_box").destroy()}},updatePendingVideo:function(e,t){e.stop();var o=t.getSiblings("input[name=clip_id]")[0].get("value");Browse.groupPendingVideo.send({data:{action:"pending_video",mode:t.get("name"),clip_id:o,token:vimeo.xsrft}})},onGroupPendingVideoSuccess:function(e,t){if(e.success===true){Browse.removeItem("clip_"+e.clip_id);if(e.mode==="accept"){if(History.getPathName().indexOf("/pending")!==-1){Browse.clearTabCache(History.getPathName().substring(0,History.getPathName().indexOf("/pending")))}}}},updateCouchmodeUrl:function(e){var t,o,s=/\/sort:.*\//;t=e.match(s);if(t&&t.length&&Browse.couchmodeLink){o=Browse.couchmodeLink.get("href");if(o.indexOf("sort")>-1){o.replace(s,t.shift())}else{o+=t.shift()}Browse.couchmodeLink.set("href",o)}}};window.addEvent("domready",function(){if($("browser")){Browse.initialize()}});var Pager=new Class({Implements:[Options,Events],LEFT_DIRECTION:1,RIGHT_DIRECTION:2,cache:new Hash,direction:null,url:null,formerUrl:null,lastRequestedUrl:null,placeholder:document.createElement("div"),container:null,request:null,interactionsLocked:false,viewportStyles:null,options:{container:null,viewport_selector:null,pagerControlSelector:"a",onBeforeChange:function(){},onChange:function(){},additionalRequestData:{},storeState:false,excludeUrls:[],slide:false,leftSlideControlSelector:"a.left",rightSlideControlSelector:"a.right",slideControlsDisabledCls:null},initialize:function(e){this.setOptions(e);if(typeof this.options.container==="undefined"){throw new Error("The container option is mandatory in the Pager component")}this.request=new Request({url:"/",method:"get",onSuccess:this.onRequestSuccess.bind(this)});this.container=$(this.options.container);this.attachHandlers();var t=this.container.getElement(this.options.viewport_selector);this.viewportStyles=t.getStyles(["margin-left"]);if(this.options.storeState){this.cache.set(History.getPathName(),this.container.get("html"));this.formerUrl=History.getPathName();History.pageLoad()}this.checkArrowVisibility()},attachHandlers:function(){var e=this;if(!this.options.slide){this.container.addEvent("click:relay("+this.options.pagerControlSelector+")",this.onBtnClick.bind(this))}else{this.container.addEvent("click:relay("+this.options.leftSlideControlSelector+")",this.onBtnClick.bind(this));this.container.addEvent("click:relay("+this.options.rightSlideControlSelector+")",this.onBtnClick.bind(this))}if(this.options.storeState){History.hashFallback=true;History.addEvent("change",this.onHistoryChange.bind(this))}this.container.addEvent("swipe",function t(o){var s={left:"right",right:"left"},i=o.direction,n=$$(".js-swipe_"+s[i]+" a")[0];if(n){e.onBtnClick(n)}})},onBtnClick:function(e){if(this.interactionsLocked){return}var t;if(e.tagName&&e.tagName.toLowerCase()==="a"){t=e}else{e.preventDefault();t=$(e.target);if(!this.options.slide&&!t.match(this.options.pagerControlSelector)){t=t.getParent(this.options.pagerControlSelector)}else if(this.options.slide&&!t.match(this.options.leftSlideControlSelector+","+this.options.rightSlideControlSelector)){t=t.getParent(this.options.leftSlideControlSelector+","+this.options.rightSlideControlSelector)}}var o=t.get("href"),s=this.resolveIndexFromUrl(this.formerUrl),i=this.resolveIndexFromUrl(o);this.direction=s<=i?this.RIGHT_DIRECTION:this.LEFT_DIRECTION;this.url=o;if(o.indexOf("javascript")===0||o.indexOf("#")===0){return}if(this.options.storeState){History.push(this.url)}else{this.load(this.url)}},load:function(e){if(this.formerUrl!==e){this.formerUrl=e;if(this.cache.get(e)!==null){this.onRequestSuccess(this.cache.get(e))}else{this.request.send({url:e,data:this.options.additionalRequestData})}}},onHistoryChange:function(e){var t=true;if(this.interactionsLocked){this.lastRequestedUrl=e;return}this.options.excludeUrls.each(function(o){if(e.match(o)!==null){t=false}});if(t){var o=this.resolveIndexFromUrl(this.formerUrl),s=this.resolveIndexFromUrl(e);this.direction=o<s?this.RIGHT_DIRECTION:this.LEFT_DIRECTION;this.load(e);this.url=e}},resolveIndexFromUrl:function(e){var t,o;if(!e||!e.contains("page:")){return 1}t=e.split("/page:");o=t[1].toInt();return o},onRequestSuccess:function(e){var t,o,s,i;this.fireEvent("beforeChange",this.url);if(this.cache.get(this.url)===null){this.cache.set(this.url,e)}if(this.options.slide){var n;this.placeholder.innerHTML=e;var r=this.container.getElement(this.options.viewport_selector),a=this.container.getElement(this.options.leftSlideControlSelector),l=this.placeholder.getElement(this.options.leftSlideControlSelector).get("href");a.set("href",l);if(this.options.slideControlsDisabledCls!==null){if(l.indexOf("javascript")===0||l.indexOf("#")===0){if(!a.hasClass(this.options.slideControlsDisabledCls)){a.addClass(this.options.slideControlsDisabledCls)}}else if(a.hasClass(this.options.slideControlsDisabledCls)){a.removeClass(this.options.slideControlsDisabledCls)}}var c=this.container.getElement(this.options.rightSlideControlSelector),d=this.placeholder.getElement(this.options.rightSlideControlSelector).get("href");c.set("href",d);if(this.options.slideControlsDisabledCls!==null){if(d.indexOf("javascript")===0||d.indexOf("#")===0){if(!c.hasClass(this.options.slideControlsDisabledCls)){c.addClass(this.options.slideControlsDisabledCls)}}else if(c.hasClass(this.options.slideControlsDisabledCls)){c.removeClass(this.options.slideControlsDisabledCls)}}t=this.placeholder.getElement(this.options.viewport_selector).getChildren();o=this.getItems();if(this.direction===this.LEFT_DIRECTION){for(s=t.length-1;s>=0;s--){t[s].inject(r,"top")}i=parseInt(this.viewportStyles["margin-left"],10)||0;n=i-(o[0].offsetLeft-t[0].offsetLeft)}else{for(s=0;s<t.length;s++){t[s].inject(r)}n=parseInt(this.viewportStyles["margin-left"],10)||0;i=n-(t[0].offsetLeft-o[0].offsetLeft)}this.interactionsLocked=true;var u=new Fx.Tween.CSS3(r,{unit:"px",duration:250,transition:"expo:in:out",onComplete:function(){u.cancel();o.each(function(e,t){e.destroy()});r.setStyles({"margin-left":this.viewportStyles["margin-left"],"padding-left":this.viewportStyles["padding-left"]});this.interactionsLocked=false;this.fireEvent("change",this.url);if(this.options.storeState&&this.lastRequestedUrl!==null){this.load(this.lastRequestedUrl)}this.lastRequestedUrl=null}.bind(this)}).start("margin-left",n,i)}else{this.container.innerHTML=e;this.interactionsLocked=false;this.fireEvent("change",this.url);if(this.options.storeState&&this.lastRequestedUrl!==null){this.load(this.lastRequestedUrl)}this.lastRequestedUrl=null}this.checkArrowVisibility()},checkArrowVisibility:function(){var e=$$(".related_arrow_left a")[0],t=$$(".related_arrow_right a")[0],o=$$(".spotlight_arrow_left a")[0],s=$$(".spotlight_arrow_right a")[0],i=$$(".gallery_arrow_left a")[0],n=$$(".gallery_arrow_right a")[0],r=[e,t,o,s,i,n];for(var a=0;a<r.length;a++){if(r[a]){if(r[a].get("href").indexOf("javascript")===0||r[a].get("href").indexOf("#")===0){r[a].setStyle("display","none")}else{r[a].setStyle("display","block")}}}},getItems:function(){return this.container.getElement(this.options.viewport_selector).getChildren()}});var Share={storage:null,initialize:function(){var e=$("share_popup"),t;Share.loadDependencies();Share.columns=e.getElements(".col");if(Share.columns.length>=2){Share.columnPadding=Share.columns[0].getStyle("padding-top").toInt()+Share.columns[0].getStyle("padding-bottom").toInt()}if(Cookie.read("embed_preferences")){Share.storage=JSON.decode(Cookie.read("embed_preferences"))}e.getElements(".toggle_box").each(function(e){t=new ToggleBox(e,{onToggle:function(){Share.equalize()}})});Share.equalize();if($("message_input")){$("message_input").addEvent("keyup",this.onMessageUpdate)}},loadDependencies:function(){Share.onForageLoaded()},equalize:function(){var e,t;if(Share.columns.length<2){return false}Share.columns.each(function(e,t){e.erase("style")});Share.columns.each(function(o,s){e=o.measure(function(){return this.getSize().y});if(s===0||e>t){t=e-Share.columnPadding}});Share.columns.each(function(e,o){e.setStyle("height",t+"px")});return true},onForageLoaded:function(){Share.forage=new Forage.Share("fg",{addEmails:!$("fg").hasClass("no_email"),form:"mailer",onUserAdded:function(){setTimeout(function(){Share.equalize()},50)},onUserRemoved:function(){setTimeout(function(){Share.equalize()},50)}});Global.lightbox.centerWindow();if(Global.shareLightbox){Global.shareLightbox.centerWindow()}Global.xsrfProtect()},onColorPickerLoaded:function(){var e;if(!$("share_embed")){return}if(Share.storage){e=Share.storage.color}if($("color_picker_toggle")){Embed.colorPicker=new ColorPicker("color_picker_toggle",{initial_color:e||$("embed_color").get("value"),onUpdate:function(e){var t=e.hex.toLowerCase();Embed.customizations.colorInput.set("value",t);Embed.setColor(t)},onSelect:function(e){var t=e.hex.toLowerCase();Embed.customizations.colorInput.set("value",t);Embed.setColor(t);Embed.refreshEmbedCode()}})}},onMessageUpdate:function(e){$("message").set("text",this.value)}};var Embed={customizations:{},warnings:{},originalValues:{},codeRequest:null,initialize:function(){if(!$("share_embed")){return false}Embed.clipId=$("embed_clip_id").get("value");Embed.textArea=$("embed_code");Embed.customizeView=$("embed_customize");Embed.customizeToggle=$("embed_customize_toggle");Embed.codeToggles=$("embed_generator").getElements("a.embed_code_toggle");Embed.previewPlayer=$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));Embed.customizations={widthInput:$("embed_width"),heightInput:$("embed_height"),titleCheckbox:$("embed_title"),bylineCheckbox:$("embed_byline"),portraitCheckbox:$("embed_portrait"),badgeCheckbox:$("embed_badge"),autoplayCheckbox:$("embed_autoplay"),loopCheckbox:$("embed_loop"),linkCheckbox:$("embed_link"),descriptionCheckbox:$("embed_description"),staticColors:$("embed_customize").getElements(".color_block"),colorInput:$("embed_color")};Embed.warnings={size:$("size_alert"),autoplay:$("autoplay_alert"),loop:$("loop_alert"),caption:$("text_alert"),link:$("link_alert"),description:$("description_alert"),link_description:$("link_description_alert")};Embed.originalValues={width:$("embed_orig_width").get("value"),height:$("embed_orig_height").get("value")};Embed.codeRequest=new Request({url:"/embed",method:"get",link:"cancel",onSuccess:Embed.onEmbedCodeSuccess});$("embed_customize").getElements(".toggle_box").each(function(e){var t=new ToggleBox(e);t.addEvent("onToggle",function(){Share.equalize()})});Share.onColorPickerLoaded();Embed.attachEvents();Embed.refreshEmbedCode();try{Singletonbox.centerWindow()}catch(e){}},attachEvents:function(){Object.each(Embed.customizations,function(e,t){if($(e)){$(e).addEvent("change",Embed.onOptionChange)}});[Embed.customizations.widthInput,Embed.customizations.heightInput].each(function(e){e.addEvent("keydown",Embed.onDimensionKeyDown);e.addEvent("blur",Embed.onDimensionBlur)});Embed.customizations.staticColors.addEvent("click",Embed.onStaticColorSelected);Embed.customizations.colorInput.addEvent("keydown",Embed.onColorKeyDown);Embed.textArea.addEvent("click",Embed.onTextAreaClick);$("old_code").addEvent("click",function(){Embed.refreshEmbedCode(true)})},resetSize:function(){Embed.customizations.widthInput.set("value",Embed.originalValues.width);Embed.customizations.heightInput.set("value",Embed.originalValues.height)},calculateSize:function(e){var t,o,s;switch(e){case"x":case"width":t=Embed.customizations.heightInput.get("value")
;o=Embed.originalValues.width/Embed.originalValues.height;break;case"y":case"height":t=Embed.customizations.widthInput.get("value");o=Embed.originalValues.height/Embed.originalValues.width;break;default:throw new Error("Invalid direction")}s=Math.round(t*o);return s},resetWarnings:function(){Object.each(Embed.warnings,function(e){$(e).hide()})},checkWarnings:function(){var e=Embed.customizations,t=Embed.warnings;Embed.resetWarnings();if(e.autoplayCheckbox.get("checked")){t.autoplay.show()}if(e.loopCheckbox.get("checked")){t.loop.show()}if(e.linkCheckbox.get("checked")||e.descriptionCheckbox.get("checked")){t.caption.show();if(e.descriptionCheckbox.get("checked")&&e.linkCheckbox.get("checked")){t.link_description.show("inline")}else if(e.descriptionCheckbox.get("checked")){t.description.show("inline")}else if(e.linkCheckbox.get("checked")){t.link.show("inline")}}Share.equalize()},refreshEmbedCode:function(e){var t=Embed.customizations;Embed.checkWarnings();Embed.savePreferences();Embed.codeRequest.send({data:{clip_id:Embed.clipId,width:t.widthInput.get("value"),height:t.heightInput.get("value"),title:t.titleCheckbox.get("checked")?1:0,byline:t.bylineCheckbox.get("checked")?1:0,portrait:t.portraitCheckbox.get("checked")?1:0,badge:t.badgeCheckbox&&t.badgeCheckbox.get("checked")?1:0,autoplay:t.autoplayCheckbox.get("checked")?1:0,loop:t.loopCheckbox.get("checked")?1:0,color:t.colorInput.get("value"),link:t.linkCheckbox.get("checked")?1:0,caption:t.descriptionCheckbox.get("checked")?1:0,iframe:e===true?false:true}});if(e===true){$("code_notice").setStyle("visibility","hidden")}else{$("code_notice").setStyle("visibility","visible")}},savePreferences:function(){var e=Embed.customizations,t=JSON.encode({width:e.widthInput.get("value").toInt(),title:e.titleCheckbox.get("checked")?1:0,byline:e.bylineCheckbox.get("checked")?1:0,badge:e.badgeCheckbox&&e.badgeCheckbox.get("checked")?1:0,portrait:e.portraitCheckbox.get("checked")?1:0,autoplay:e.autoplayCheckbox.get("checked")?1:0,loop:e.loopCheckbox.get("checked")?1:0,color:e.colorInput.get("value"),link:e.linkCheckbox.get("checked")?1:0,caption:e.descriptionCheckbox.get("checked")?1:0});Cookie.write("embed_preferences",t,{domain:vimeo.domain,path:"/",duration:365})},refreshPreview:function(e){var t=Embed.customizations,o=e.get("checked");switch(e){case t.titleCheckbox:Embed.toggleElement("title",o);break;case t.bylineCheckbox:Embed.toggleElement("byline",o);break;case t.portraitCheckbox:Embed.toggleElement("portrait",o);break;case t.badgeCheckbox:Embed.toggleElement("badge",o);break;default:throw new Error("Invalid option supplied.")}},onTextAreaClick:function(e){if(!this.get("data-ios")){e.stop();this.focus();this.select()}},onDimensionKeyDown:function(e){var t=this,o=e.code,s=e.key,i=o>47&&o<58||o>95&&o<106,n=s==="delete"||s==="backspace"||s==="tab"||s==="left"||s==="right"||s==="up"||s==="down",r=i&&!e.shift||n,a=Embed.customizations.widthInput,l=Embed.customizations.heightInput;if(r){setTimeout(function(){if(t===a){l.set("value",Embed.calculateSize("height"))}else{a.set("value",Embed.calculateSize("width"))}},50)}else{e.preventDefault();return}},onDimensionBlur:function(e){if(Embed.customizations.widthInput.get("value")===""||Embed.customizations.heightInput.get("value")===""){Embed.resetSize()}},onOptionChange:function(e){var t=Embed.customizations;if(this===t.titleCheckbox||this===t.bylineCheckbox||this===t.portraitCheckbox||this===t.badgeCheckbox){Embed.refreshPreview(this)}Embed.refreshEmbedCode()},onStaticColorSelected:function(e){var t=["#",this.get("data-hex")].join("");e.stop();Embed.customizations.colorInput.set("value",t);Embed.onOptionChange(null);Embed.colorPicker.setColor(t)},onColorKeyDown:function(e){var t=e.key,o=e.shift,s=t==="delete"||t==="backspace"||t==="tab"||t==="left"||t==="right"||t==="up"||t==="down",i=!o&&/[a-fA-F0-9]/.test(t),n=o&&t==="3",r=i||n||s;if(!r){e.preventDefault()}},onEmbedCodeSuccess:function(e,t){Embed.textArea.set("value",e.clean());Share.equalize()},onPlayerLoaded:function(){},toggleElement:function(e,t){Embed.previewPlayer=Embed.previewPlayer||$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));Embed.previewPlayer.api_toggleElement(e,t)},setColor:function(e){Embed.previewPlayer=Embed.previewPlayer||$("embed_preview").getElement(['*[id*="player',Embed.clipId,'"]'].join(""));if(e.substr(0,1)==="#"){e=e.substr(1)}try{Embed.previewPlayer.api_changeColor(e)}catch(e){}}};var Group={member_status_pending:"member_status_pending",initialize:function(){var e=$("group_members_browser"),t=$("group_mods_browser"),o=$("group_pending_members_browser");Group.invite=$("group_invite");Group.group_main_videos=$$("#browser.group_main_browser")[0];Group.group_videos=$$("#browser.group_videos_browser")[0];if($("grid")){Group.setUpGrid()}else{if(Group.group_main_videos){Group.setupMain()}}if(Group.group_videos){Group.setupVideos()}if(e){Signal.browse.tabs.click.add(Group.onUsersTabSignal);Group.setupMembers()}if(t){Signal.browse.tabs.click.add(Group.onUsersTabSignal);Group.setupMods()}if(o){Group.setupPendingMembers()}if(Group.invite){Group.invite.addEvent("click",Group.onGroupInviteClick)}Signal.player.finish.add(Group.onPlayerFinish)},setupMain:function(){var e=$("expand");if(e!==null){e.addEvent("click",function(e){e.stop();this.getParent().hide().getNext().show()})}Group.removable_videos=Group.group_main_videos.getElements(".undertaker_list")[0];if(Group.removable_videos!==null){var t=new Undertaker(Group.removable_videos,{url:location.href,itemSelector:".js-browse_list li",onRemove:Group.onRemoveClip,onComplete:Group.onRemoveClipComplete})}Group.setupJoin();var o=$("stop_mod");if(o!==null){var s=new Request.JSON({url:location.href,method:"post",onSuccess:function(e){o.hide()}});o.addEvent("click",function(e){e.preventDefault();s.send({data:{action:"stop_mod",token:vimeo.xsrft}})})}},setUpGrid:function(){var e=$("stream")||$("grid")||$("gallery");if(e!==null){Group.container=$("stream")||$("grid")||$("gallery");Group.mode=Group.container.get("id");if(Group.mode!=="stream"){Group.setActiveClip()}if(Group.mode!=="stream"){this.pager=new Pager({container:Group.container,viewport_selector:"ol",pagerControlSelector:"a",storeState:true,excludeUrls:[/\/groups\/([a-zA-Z0-9]{1,24})\/([0-9]+)$/g],slide:Group.mode==="gallery"?true:false,leftSlideControlSelector:"div.arrow_left>a",rightSlideControlSelector:"div.arrow_right>a",onBeforeChange:function(){},onChange:function(e){Group.setActiveClip()}})}if(!Browser.ie||Browser.ie&&Browser.version>8){if(Group.mode!=="stream"){Group.container.addEvent("click:relay(ol>li>a)",function(e){var t=$(this).get("href");History.push(t);e.stop()});History.addEvent("change",function(e){if(e&&e.match(/\/groups\/([a-zA-Z0-9]{1,24})\/([0-9]+)$/g)){Group.playClip(e)}})}if(Group.mode==="grid"){History.addEvent("change",function(){Global.scroll.toElement("grid")})}}else{Group.container.addEvent("click:relay(ol>li>a)",function(e){e.preventDefault();var t=$(this).get("href");window.location=t})}}Group.setupJoin()},setActiveClip:function(){var e=$(Group.mode).getElement("li.selected");if(e!==null){e.removeClass("selected")}var t=$("clip_"+GroupConfig.clip_id);if(t!==null){t.addClass("selected")}},playClip:function(e){var t=parseInt(e.split("/").getLast(),10),o=$("video"),s,i;Group.destroyVideos();if(!(Browser.ie&&Browser.version<9)){Global.smoothScroll("video",true)}Group.requestedClipId=t;Group.clip_request=Group.clip_request||new Request.HTML({method:"get",update:"video",onSuccess:Group.onClipRequestSuccess});Group.clip_request.send({data:{action:"clip_container",group_id:GroupConfig.group_id,clip_id:t,clip_width:o.getWidth(),clip_height:o.getHeight(),autoplay:Group.do_autoplay||0,description_limit:$("video").getElement(".description").get("data-description-limit").toInt()}})},destroyVideos:function(e){$$(".player").each(function(e){var t=e.get("id").split("player_").join("player");var o=window[t];try{o.player.destroy()}catch(e){}});if(e instanceof Function){e()}},setupJoin:function(){var e=$("join"),t=$("leave"),o=$("pending"),s;if(e===null&&t===null){return}s=new Request.JSON({url:location.href,method:"post",onSuccess:function(s){e.getElement("a").addClass("iconify_check_b").removeClass("btn_gray");t.addClass("btn_gray").set("text",Copy.dict.leave_group);if(s===true){e.hide();t.show("inline");e.getElement("a").set("html",Copy.dict.joined_group);return}else if(s===Group.member_status_pending){e.hide();o.show();return}else{t.hide();e.getElement("a").set("html",Copy.dict.join_group);e.show()}}});if(e){e.getElement("a").addEvent("click",function(t){t.preventDefault();e.getElement("a").removeClass("iconify_check_b").addClass("btn_gray").set("html",Copy.dict.joining_group+"&hellip;");s.send({data:{action:"join",token:vimeo.xsrft}})})}if(t){t.addEvent("click",function(e){e.stop();t.addClass("btn_gray").set("html",Copy.dict.leaving_group+"&hellip;");s.send({data:{action:"unjoin",token:vimeo.xsrft}})})}},setupVideos:function(){Group.removable_videos=Group.group_videos.getElements(".undertaker_list")[0];if(Group.removable_videos!==null){var e=new Undertaker(Group.removable_videos,{url:location.href,itemSelector:".js-browse_list li",onRemove:Group.onRemoveItem,onComplete:Group.onRemoveItemComplete})}},setupMembers:function(){var e=$("group_members_browser").getElements(".undertaker_list")[0];if(e!==undefined){Group.user_undertaker=new Undertaker(e,{url:location.href,action_name:"delete_member",itemSelector:".js-browse_list li",require_reason:true,prompt_view_url:location.href+"/delete/reason",onRemove:Group.onRemoveItem,onComplete:Group.onRemoveItemComplete})}},setupMods:function(){var e=$("group_mods_browser").getElements(".undertaker_list")[0];if(e!==undefined){Group.user_undertaker=new Undertaker(e,{url:location.href,action_name:"delete_mod",itemSelector:".js-browse_list li",itemsIgnore:"data-undertaker-ignore",onRemove:Group.onRemoveItem,onComplete:Group.onRemoveItemComplete})}},setupPendingMembers:function(){var e=$("group_pending_members_browser").getElements(".undertaker_list")[0];if(e!==undefined){Group.user_undertaker=new Undertaker(e,{url:location.href,action_name:"deny_membership",promoter_action:"approve_membership",itemSelector:".js-browse_list li",onRemove:Group.onRemoveItem,onComplete:Group.onRemoveItemComplete})}},onBrowseEventsReady:function(){Group.initialize()},onRemoveItem:function(){var e=$$(".undertaker_list")[0];e.getElements(".js-browse_list li").removeClass("last");e.getElements(".js-browse_list li:even").addClass("last")},onRemoveItemComplete:function(){Browse.cache.empty()},onClipRequestSuccess:function(){var e=$("video"),t=$("clips"),o,s,i,n,r;GroupConfig.clip_id=Group.requestedClipId;o=$("clip_"+GroupConfig.clip_id);if(o!==null){Group.setActiveClip();return}e.getElement(".description").hide();e.getElement(".time").hide();e.getElement(".stats").hide();e.getElement(".url").getElement("a").set("href","/"+GroupConfig.clip_id).set("text","vimeo.com/"+GroupConfig.clip_id);t.getElements("li").removeClass("selected")},onPlayerFinish:function(){if(GroupConfig.autoplay_enabled===true){setTimeout(Group.loadNextVideo,1e3)}},onUsersTabSignal:function(e){Signal.browse.attachEvents.removeAll();Signal.browse.attachEvents.add(Group.initialize)},onGroupInviteClick:function(){vimeo.Modal.create({content:"?action=share"})}};window.addEvent("domready",function(){Group.initialize()});var Compose={initialize:function(){Global.xsrfProtect();Compose.form=$("compose_message");Compose.nameInput=$("cm_name");Compose.emailInput=$("cm_email");Compose.uuidInput=$("cm_uuid");Compose.messageInput=$("cm_message");Compose.successMsg=$("cm_success");Compose.user_thumb=Compose.form.getElement(".portrait_sm");if(Compose.user_thumb){Compose.default_avatar=Compose.user_thumb.get("src")}if(typeof AutoComplete!=="undefined"&&Compose.nameInput!==null&&Compose.nameInput.get("disabled")!==true){Compose.autoCompleter=new AutoComplete(Compose.nameInput,{hideOnEmptySet:false,parentElement:Compose.form,onSuggestionSelect:Compose.onUserSelected})}else{Compose.messageInput.focus()}Compose.validator=new Form.Validator.Inline(Compose.form,{errorPrefix:"",useTitles:true,ignoreHidden:false,ignoreDisabled:true,scrollToErrorsOnSubmit:false,onFormValidate:Compose.onFormValidate});Compose.request=new Form.Request(Compose.form,null,{resetForm:false,progress:false,onSuccess:Compose.onSendSuccess,onFailure:Compose.onSendFailure});Compose.attachEvents()},attachEvents:function(){if(Compose.nameInput!==null){Compose.nameInput.addEvents({keydown:Compose.onUserKeyPress,keyup:Compose.onUserKeyPress})}if($("cm_cancel")){$("cm_cancel").addEvent("click",Compose.onCancelClick)}if(Compose.form.getElement('input[type="submit"]')){Compose.form.getElement('input[type="submit"]').addEvent("click",function(e){if(Compose.preProcessFailed()){e.preventDefault();Compose.onSendSuccess()}})}if(Compose.successMsg){Global.lightbox.setOptions({onClose:Compose.hideSuccessMessage})}},onUserKeyPress:function(e){if(e.key==="enter"){e.stop()}},onUserSelected:function(e){if(e.getElement(".title")!==null){Compose.nameInput.set("value",e.getElement(".title").get("text"))}if(e.getElement(".portrait_sm")){Compose.form.getElement(".portrait_sm").set("src",e.getElement(".portrait_sm").get("src"))}Compose.uuidInput.set("value",e.get("rel"));Compose.messageInput.focus()},onFormValidate:function(e,t){Compose.form.getElements("div.error_message").each(function(e){e.dispose()});var o=t.getElement(".error_message"),s=t.getElements(".validation-advice");if(!e){if(!o){o=new Element("div",{class:"error_message"});t.adopt(o)}s.each(function(e){e.retrieve("reveal").cancel();e.toggle()});o.adopt(s);if((Compose.uuidInput!==null||Compose.emailInput!==null)&&Compose.nameInput!==null&&Compose.uuidInput.hasClass("validation-failed")&&!Compose.nameInput.hasClass("validation-failed")){Compose.nameInput.addClass("validation-failed")}}else{if(o!==null){o.hide()}}},preProcessFailed:function(){var e=["246801"],t,o=Compose.messageInput.get("value").indexOf("vimeo.com/")!==-1;if(Compose.uuidInput){t=e.contains(Compose.uuidInput.get("value").toString())}return o&&t},onSendSuccess:function(e,t){Compose.resetForm();Compose.refreshSentView();Compose.renderSuccessMessage();Compose.hideForm();setTimeout(Compose.closeModal,1500);Signal.messages.message_sent.dispatch()},onSendFailure:function(e){Compose.form.getElements("div.error_message").each(function(e){e.dispose()});if(e.status===418){var t=e.responseText,o=JSON.decode(t),s=Compose.validator.getFields();s.each(function(e){if(typeof o[e.name]!=="undefined"){e.addClass("validation-failed").removeClass("validation-passed")}})}else{Compose.form.adopt(new Element("div",{class:"error_message",html:Copy.dict.message_send_error}))}},onCancelClick:function(e){e.stop();Compose.resetForm();Global.lightbox.close()},renderSuccessMessage:function(){if(Compose.successMsg){Compose.successMsg.removeClass("hide").tween("opacity",1)}},hideSuccessMessage:function(){if(Compose.successMsg){Compose.successMsg.addClass("hide")}},resetForm:function(){var e=[".error_message"],t=0,o=e.length;Compose.validator.reset();if(Compose.autoCompleter){Compose.autoCompleter.reset()}for(t=0;t<o;t++){if(Compose.form.getElement(e[t])){Compose.form.getElement(e[t]).destroy()}}try{Compose.nameInput.focus();Compose.nameInput.blur()}catch(e){Compose.messageInput.focus()}if(Compose.nameInput!==null&&Compose.nameInput.get("disabled")===false){if(Compose.uuidInput!==null){Compose.uuidInput.set("value","")}}if(Compose.messageInput!==null){Compose.messageInput.set("value","")}if(Compose.user_thumb){Compose.user_thumb.set("src",Compose.default_avatar)}},hideForm:function(){Compose.form.addClass("hide")},showForm:function(){Compose.form.removeClass("hide")},refreshSentView:function(){if(typeof Browse==="undefined"||!Browse.cache){return}var e=$("filter");if(e===null){return}var t=e.getElement('a[data-browse-type="sent"]'),o=t.get("href");Browse.cache.erase(o);if(t.hasClass("selected")){History.push(o);History.pageLoad()}},closeModal:function(){Global.lightbox.close();Compose.showForm();if(Compose.successMsg){Compose.successMsg.addClass("hide")}}};
//# sourceMappingURL= 